import useLocalStorage from '@/hooks/useLocalStorage'
import { ApiError, authApi } from '@/lib/api'
import type { SignupRequest } from '@/types'
import React, { useMemo, useRef, useState } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import DaumPostcodeModal from './DaumPostcodeModal'
import { useToast } from './ToastProvider'

const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/

const Signup: React.FC = () => {
  const navigate = useNavigate()
  const [name, setName] = useLocalStorage<string>('signup.name', '')
  const [birthDate, setBirthDate] = useLocalStorage<string>(
    'signup.birthDate',
    ''
  )
  const [gender, setGender] = useLocalStorage<'ÎÇ®' | 'Ïó¨' | ''>(
    'signup.gender',
    ''
  )
  const [phone, setPhone] = useLocalStorage<string>('signup.phone', '')
  const [email, setEmail] = useLocalStorage<string>('signup.email', '')
  const [password, setPassword] = useLocalStorage<string>('signup.password', '')
  const [passwordConfirm, setPasswordConfirm] = useLocalStorage<string>(
    'signup.passwordConfirm',
    ''
  )
  const [postcode, setPostcode] = useLocalStorage<string>('signup.postcode', '')
  const [address1, setAddress1] = useLocalStorage<string>('signup.address1', '')
  const [address2, setAddress2] = useLocalStorage<string>('signup.address2', '')
  const [isLoading, setIsLoading] = useState(false)
  const [phoneDupLoading, setPhoneDupLoading] = useState(false)
  const [phoneChecked, setPhoneChecked] = useLocalStorage<boolean>(
    'signup.phoneChecked',
    false
  )
  const [phoneDuplicate, setPhoneDuplicate] = useLocalStorage<boolean>(
    'signup.phoneDuplicate',
    false
  )
  const [emailVerifyLoading, setEmailVerifyLoading] = useState(false)
  const [emailVerifySuccess, setEmailVerifySuccess] = useLocalStorage<boolean>(
    'signup.emailVerifySuccess',
    false
  )
  const [emailDupError, setEmailDupError] = useState('')
  const [emailSendOk, setEmailSendOk] = useLocalStorage<boolean>(
    'signup.emailSendOk',
    false
  )
  const [emailSendError, setEmailSendError] = useState(false)
  const [verificationCode, setVerificationCode] = useLocalStorage<string>(
    'signup.verificationCode',
    ''
  )
  const [codeConfirmLoading, setCodeConfirmLoading] = useState(false)
  const [codeConfirmError, setCodeConfirmError] = useState(false)
  const [showPostcode, setShowPostcode] = useState(false)
  const address2Ref = useRef<HTMLInputElement>(null)
  // removed: emailDupLoading, emailDupSuccess
  const { showToast } = useToast()

  const canProceed = useMemo(() => {
    const birthDigits = birthDate.replace(/\D/g, '')
    const allFilled =
      name.trim() &&
      gender &&
      birthDigits.length === 8 &&
      phone.trim() &&
      email.trim() &&
      password.trim() &&
      passwordConfirm.trim() &&
      postcode.trim() &&
      address1.trim()

    return (
      Boolean(allFilled) &&
      emailRegex.test(email) &&
      password.length >= 8 &&
      password === passwordConfirm &&
      phoneChecked &&
      !phoneDuplicate &&
      emailVerifySuccess
    )
  }, [
    name,
    gender,
    birthDate,
    phone,
    email,
    password,
    passwordConfirm,
    postcode,
    address1,
    phoneChecked,
    phoneDuplicate,
    emailVerifySuccess,
  ])

  const handleBirthDateChange = (raw: string) => {
    const digits = raw.replace(/\D/g, '').slice(0, 8)
    let formatted = digits
    if (digits.length > 4) {
      formatted = `${digits.slice(0, 4)}.${digits.slice(4)}`
    }
    if (digits.length > 6) {
      formatted = `${digits.slice(0, 4)}.${digits.slice(4, 6)}.${digits.slice(6)}`
    }
    setBirthDate(formatted)
  }

  const handleBack = () => {
    if (window.history.length > 1) {
      navigate(-1)
    } else {
      navigate('/login')
    }
  }

  const handleSubmit = async (e?: React.FormEvent) => {
    if (e) e.preventDefault()
    if (!canProceed) return
    setIsLoading(true)
    try {
      // birthDate: YYYY.MM.DD -> YYYY-MM-DD
      const birthDigits = birthDate.replace(/\D/g, '')
      const birthFormatted = `${birthDigits.slice(0, 4)}-${birthDigits.slice(4, 6)}-${birthDigits.slice(6, 8)}`

      const payload: SignupRequest = {
        password,
        name,
        email,
        birthdate: birthFormatted,
        sex: gender === 'ÎÇ®' ? 'M' : 'F',
        phone,
        address: `${postcode} ${address1} ${address2}`.trim(),
      }

      await authApi.signup(payload)
      // ÌöåÏõêÍ∞ÄÏûÖ ÏôÑÎ£å Ïãú Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏùò ÌöåÏõêÍ∞ÄÏûÖ Í¥ÄÎ†® ÌÇ§Îì§ Ï†ïÎ¶¨
      try {
        const keysToClear = [
          'signup.name',
          'signup.birthDate',
          'signup.gender',
          'signup.phone',
          'signup.email',
          'signup.password',
          'signup.passwordConfirm',
          'signup.postcode',
          'signup.address1',
          'signup.address2',
          'signup.emailSendOk',
          'signup.verificationCode',
          'signup.phoneChecked',
          'signup.phoneDuplicate',
          'signup.emailVerifySuccess',
        ]
        keysToClear.forEach(k => localStorage.removeItem(k))
      } catch (cleanupError) {
        console.warn(
          'Failed to clear signup draft from localStorage',
          cleanupError
        )
      }
      navigate('/login', { replace: true })
      // ÎùºÏö∞ÌåÖ ÌõÑÏóêÎèÑ Ïú†ÏßÄÎêòÎäî Ï†ÑÏó≠ ÌÜ†Ïä§Ìä∏
      setTimeout(() => {
        showToast('ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêòÏóàÏñ¥Ïöîüôå\nÎ°úÍ∑∏Ïù∏ÏùÑ Ìï¥Ï£ºÏÑ∏Ïöî.', 3500)
      }, 0)
    } catch (error) {
      console.error('Signup failed', error)
      // TODO: ÏóêÎü¨ Î©îÏãúÏßÄ UI ÌïÑÏöî Ïãú Ï∂îÍ∞Ä
    } finally {
      setIsLoading(false)
    }
  }

  const handlePhoneDupCheck = async () => {
    if (!phone.trim()) return
    setPhoneDupLoading(true)
    setPhoneChecked(false)
    setPhoneDuplicate(false)
    try {
      const apiBase = import.meta.env.VITE_API_BASE_URL
      const url = `${apiBase}/auth/availability/phone?value=${encodeURIComponent(phone)}`
      const response = await fetch(url, { method: 'GET' })
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`)
      }
      const data = (await response.json()) as { available: boolean }
      const isDuplicate = !data.available
      setPhoneDuplicate(isDuplicate)
      setPhoneChecked(true)
    } finally {
      setPhoneDupLoading(false)
    }
  }

  // Ïù¥Î©îÏùºÎ°ú Ïù∏Ï¶ù ÏΩîÎìú Î∞úÏÜ°
  const handleEmailVerify = async () => {
    setEmailDupError('')
    setEmailSendError(false)
    setEmailSendOk(false)
    if (!emailRegex.test(email)) return
    setEmailVerifyLoading(true)
    setEmailVerifySuccess(false)
    try {
      // 1) Ïù¥Î©îÏùº ÏÇ¨Ïö© Í∞ÄÎä• Ïó¨Î∂Ä ÌôïÏù∏
      const apiBase = import.meta.env.VITE_API_BASE_URL
      const dupUrl = `${apiBase}/auth/availability/email?value=${encodeURIComponent(email)}`
      const dupRes = await fetch(dupUrl, { method: 'GET' })
      if (!dupRes.ok) {
        throw new Error(`HTTP ${dupRes.status}`)
      }
      const dupData = (await dupRes.json()) as { available: boolean }
      if (!dupData.available) {
        setEmailDupError('Ïù¥ÎØ∏ Îì±Î°ùÎêú Ïù¥Î©îÏùºÏûÖÎãàÎã§.')
        return
      }

      // 2) ÏÇ¨Ïö© Í∞ÄÎä•ÌïòÎ©¥ Ïù∏Ï¶ù Î©îÏùº Î∞úÏÜ°
      await authApi.sendEmailVerification(email)
      setEmailSendOk(true)
    } catch (error) {
      setEmailSendError(true)
      if (error instanceof ApiError && error.status === 409) {
        setEmailDupError('Ïù¥ÎØ∏ Îì±Î°ùÎêú Ïù¥Î©îÏùºÏûÖÎãàÎã§.')
      }
    } finally {
      setEmailVerifyLoading(false)
    }
  }

  // Ïù∏Ï¶ù ÏΩîÎìú ÌôïÏù∏
  const handleConfirmCode = async () => {
    if (!verificationCode.trim()) return
    setCodeConfirmLoading(true)
    setCodeConfirmError(false)
    try {
      await authApi.confirmEmailVerification(email, verificationCode.trim())
      setEmailVerifySuccess(true)
    } catch (_error) {
      setEmailVerifySuccess(false)
      setCodeConfirmError(true)
    } finally {
      setCodeConfirmLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-white flex flex-col">
      {/* Top App Bar (no native status bar) */}
      <header className="h-12 flex items-center border-b border-gray-200 px-2">
        <button
          type="button"
          onClick={handleBack}
          className="p-3 text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-300 rounded"
          aria-label="Îí§Î°úÍ∞ÄÍ∏∞"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M15 18L9 12L15 6"
              stroke="currentColor"
              strokeWidth="2"
              strokeLinecap="round"
              strokeLinejoin="round"
            />
          </svg>
        </button>
        <div className="flex-1 text-center -ml-6">
          <h1 className="text-[17px] font-pretendard font-medium text-gray-900">
            ÌöåÏõêÍ∞ÄÏûÖ
          </h1>
        </div>
      </header>

      {/* Form */}
      <main className="flex-1 flex flex-col items-center">
        <form
          onSubmit={handleSubmit}
          className="w-full max-w-sm px-6 pt-6 pb-24 space-y-5"
        >
          {/* Name + Gender inline */}
          <div>
            <label className="block text-[10px] text-[#C3CCC9] font-pretendard font-medium">
              Ïù¥Î¶Ñ
            </label>
            <div className="mt-1 flex items-end gap-3">
              <input
                name="name"
                value={name}
                onChange={e => setName(e.target.value)}
                placeholder="Ïù¥Î¶ÑÏù¥ Î≠êÏóêÏöî?"
                className="flex-1 pb-1 border-b border-[#C3CCC9] focus:border-b-2 focus:border-[#2F9E44] caret-[#2F9E44] placeholder-[#C3CCC9] text-[17px] text-gray-900 outline-none font-pretendard"
              />
              <div className="flex gap-2">
                <button
                  type="button"
                  onClick={() => setGender('ÎÇ®')}
                  className={`px-4 py-1.5 rounded-full border ${
                    gender === 'ÎÇ®'
                      ? 'border-[#43AE52] text-[#20342F]'
                      : 'border-[#C3CCC9] text-gray-600'
                  } text-[10px] font-pretendard`}
                >
                  ÎÇ®
                </button>
                <button
                  type="button"
                  onClick={() => setGender('Ïó¨')}
                  className={`px-4 py-1.5 rounded-full border ${
                    gender === 'Ïó¨'
                      ? 'border-[#43AE52] text-[#20342F]'
                      : 'border-[#C3CCC9] text-gray-600'
                  } text-[10px] font-pretendard`}
                >
                  Ïó¨
                </button>
              </div>
            </div>
            {/* Ïù¥Î©îÏùº Ï§ëÎ≥µ Ïò§Î•òÎäî Ïù¥Î©îÏùº ÏûÖÎ†• ÏÑπÏÖò ÏïÑÎûòÏóêÏÑú ÌëúÏãú */}
          </div>

          {/* Birthdate */}
          <div>
            <label className="block text-[10px] text-[#C3CCC9] font-pretendard font-medium">
              ÏÉùÎÖÑÏõîÏùº
            </label>
            <input
              name="birthDate"
              value={birthDate}
              onChange={e => handleBirthDateChange(e.target.value)}
              inputMode="numeric"
              pattern="[0-9]*"
              maxLength={10}
              placeholder="ex) 1990.10.19"
              className="w-full mt-1 pb-1 border-b border-[#C3CCC9] focus:border-b-2 focus:border-[#2F9E44] caret-[#2F9E44] placeholder-[#C3CCC9] text-[17px] text-gray-900 outline-none font-pretendard"
            />
          </div>

          {/* Phone with chips */}
          <div>
            <label className="block text-[10px] text-[#C3CCC9] font-pretendard font-medium">
              Ï†ÑÌôîÎ≤àÌò∏
            </label>
            <div className="mt-1 flex items-end gap-3">
              <input
                name="phone"
                value={phone}
                onChange={e => {
                  setPhone(e.target.value)
                  setPhoneChecked(false)
                  setPhoneDuplicate(false)
                }}
                inputMode="tel"
                pattern="[0-9]*"
                placeholder="ex) 01037484562"
                className="flex-1 pb-1 border-b border-[#C3CCC9] focus:border-b-2 focus:border-[#2F9E44] caret-[#2F9E44] placeholder-[#C3CCC9] text-[17px] text-gray-900 outline-none font-pretendard"
              />
              <button
                type="button"
                onClick={handlePhoneDupCheck}
                disabled={phoneDupLoading || !phone.trim()}
                className={`min-w-[90px] whitespace-nowrap justify-center px-3 py-1.5 rounded-full border text-[11px] font-pretendard flex items-center ${
                  phoneDupLoading || !phone.trim()
                    ? 'border-[#C3CCC9] text-gray-400 cursor-not-allowed opacity-70'
                    : phoneChecked && !phoneDuplicate
                      ? 'border-[#43AE52] text-[#20342F]'
                      : 'border-[#C3CCC9] text-gray-600'
                }`}
                aria-label="Ï†ÑÌôîÎ≤àÌò∏ Ï§ëÎ≥µÌôïÏù∏"
              >
                {phoneDupLoading ? (
                  <svg
                    className="animate-spin"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle
                      className="opacity-25"
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      strokeWidth="4"
                    ></circle>
                    <path
                      className="opacity-75"
                      fill="currentColor"
                      d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
                    ></path>
                  </svg>
                ) : (
                  'Ï§ëÎ≥µÌôïÏù∏'
                )}
              </button>
            </div>
            {!phoneDupLoading && phoneChecked && phoneDuplicate && (
              <p className="mt-1 text-xs text-[#DB574F] font-pretendard">
                Ïù¥ÎØ∏ Îì±Î°ùÎêú Ï†ÑÌôîÎ≤àÌò∏ÏûÖÎãàÎã§.
              </p>
            )}
            {!phoneDupLoading && phoneChecked && !phoneDuplicate && (
              <p className="mt-1 text-xs text-[#2F9E44] font-pretendard">
                ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî Î≤àÌò∏ÏûÖÎãàÎã§.
              </p>
            )}
          </div>

          {/* Email */}
          <div>
            <label className="block text-[10px] text-[#C3CCC9] font-pretendard font-medium">
              Ïù¥Î©îÏùº
            </label>
            <div className="mt-1 flex items-end gap-2">
              <input
                type="email"
                name="email"
                value={email}
                onChange={e => {
                  setEmail(e.target.value)
                  if (!e.target.value) {
                    setEmailVerifySuccess(false)
                  }
                  setEmailSendOk(false)
                  setEmailSendError(false)
                  setVerificationCode('')
                  setCodeConfirmError(false)
                  setEmailDupError('')
                }}
                placeholder="Ïù¥Î©îÏùºÏ£ºÏÜåÎ•º Ïç®Ï£ºÏÑ∏Ïöî!"
                className="flex-1 pb-1 border-b border-[#C3CCC9] focus:border-b-2 focus:border-[#2F9E44] caret-[#2F9E44] placeholder-[#C3CCC9] text-[17px] text-gray-900 outline-none font-pretendard"
              />
              {/* Ïù¥Î©îÏùºÏùÄ Î≥∏Ïù∏Ïù∏Ï¶ù Ïãú Ï§ëÎ≥µÍ≤ÄÏÇ¨ ÏàòÌñâ */}
              <button
                type="button"
                onClick={handleEmailVerify}
                disabled={!emailRegex.test(email) || emailVerifyLoading}
                className={`min-w-[90px] whitespace-nowrap justify-center px-3 py-1.5 rounded-full border text-[11px] font-pretendard flex items-center ${
                  emailSendOk || emailVerifySuccess
                    ? 'border-[#43AE52] text-[#20342F]'
                    : 'border-[#C3CCC9] text-gray-600'
                } ${emailVerifyLoading ? 'opacity-60 cursor-not-allowed' : ''}`}
                aria-label="Ïù¥Î©îÏùº Î≥∏Ïù∏Ïù∏Ï¶ù"
              >
                {emailVerifyLoading ? (
                  <svg
                    className="animate-spin"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <circle
                      className="opacity-25"
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      strokeWidth="4"
                    ></circle>
                    <path
                      className="opacity-75"
                      fill="currentColor"
                      d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
                    ></path>
                  </svg>
                ) : (
                  'Î≥∏Ïù∏Ïù∏Ï¶ù'
                )}
              </button>
            </div>
            {/* Email duplicate error */}
            {!emailVerifyLoading && emailDupError && (
              <p className="mt-1 text-xs text-[#DB574F] font-pretendard">
                {emailDupError}
              </p>
            )}
            {/* Email send result messages */}
            {!emailVerifyLoading && emailSendOk && (
              <p className="mt-1 text-xs text-[#2F9E44] font-pretendard">
                Ïù¥Î©îÏùºÏù¥ Î∞úÏÜ°ÎêòÏóàÏñ¥Ïöî.
              </p>
            )}
            {!emailVerifyLoading && emailSendError && !emailSendOk && (
              <p className="mt-1 text-xs text-[#DB574F] font-pretendard">
                Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Î¨∏ÏùòÌï¥Ï£ºÏÑ∏Ïöî.
              </p>
            )}

            {/* Verification code input: show only after send success */}
            {emailSendOk && (
              <div className="mt-3 flex items-end gap-2">
                <input
                  type="text"
                  inputMode="numeric"
                  name="verificationCode"
                  value={verificationCode}
                  onChange={e => setVerificationCode(e.target.value)}
                  placeholder="Ïù¥Î©îÏùºÎ°ú Î∞õÏùÄ ÏΩîÎìúÎ•º Î∂ôÏó¨ÎÑ£Í∏∞"
                  className="flex-1 pb-1 border-b border-[#C3CCC9] focus:border-b-2 focus:border-[#2F9E44] caret-[#2F9E44] placeholder-[#C3CCC9] text-[17px] text-gray-900 outline-none font-pretendard"
                />
                <button
                  type="button"
                  onClick={handleConfirmCode}
                  disabled={!verificationCode.trim() || codeConfirmLoading}
                  className={`min-w-[90px] whitespace-nowrap justify-center px-3 py-1.5 rounded-full border text-[11px] font-pretendard flex items-center ${
                    emailVerifySuccess
                      ? 'border-[#43AE52] text-[#20342F]'
                      : !verificationCode.trim() || codeConfirmLoading
                        ? 'border-[#C3CCC9] text-gray-400 cursor-not-allowed opacity-70'
                        : 'border-[#C3CCC9] text-gray-600'
                  }`}
                  aria-label="Ïù∏Ï¶ùÏΩîÎìú ÌôïÏù∏"
                >
                  {codeConfirmLoading ? (
                    <svg
                      className="animate-spin"
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <circle
                        className="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        strokeWidth="4"
                      ></circle>
                      <path
                        className="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
                      ></path>
                    </svg>
                  ) : (
                    'ÌôïÏù∏'
                  )}
                </button>
              </div>
            )}
            {/* Code confirm result messages */}
            {!codeConfirmLoading && emailVerifySuccess && (
              <p className="mt-1 text-xs text-[#2F9E44] font-pretendard">
                Ïù∏Ï¶ùÏóê ÏÑ±Í≥µÌñàÏñ¥Ïöî.
              </p>
            )}
            {!codeConfirmLoading && codeConfirmError && !emailVerifySuccess && (
              <p className="mt-1 text-xs text-[#DB574F] font-pretendard">
                Ïù∏Ï¶ùÏóê Ïã§Ìå®ÌñàÏñ¥Ïöî. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.
              </p>
            )}
          </div>

          {/* Password */}
          <div>
            <label className="block text-[10px] text-[#C3CCC9] font-pretendard font-medium">
              ÎπÑÎ∞ÄÎ≤àÌò∏
            </label>
            <input
              type="password"
              name="password"
              value={password}
              onChange={e => setPassword(e.target.value)}
              placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî"
              className="w-full mt-1 pb-1 border-b border-[#C3CCC9] focus:border-b-2 focus:border-[#2F9E44] caret-[#2F9E44] placeholder-[#C3CCC9] text-[17px] text-gray-900 outline-none font-pretendard"
            />
            {password && password.length < 8 && (
              <p className="mt-1 text-xs text-[#DB574F] font-pretendard">
                ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Îäî 8Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§.
              </p>
            )}
          </div>

          {/* Password Confirm */}
          <div>
            <label className="block text-[10px] text-[#C3CCC9] font-pretendard font-medium">
              ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏
            </label>
            <input
              type="password"
              name="passwordConfirm"
              value={passwordConfirm}
              onChange={e => setPasswordConfirm(e.target.value)}
              placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÎßûÎäîÏßÄ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî!"
              className={`w-full mt-1 pb-1 border-b placeholder-[#C3CCC9] text-[17px] text-gray-900 outline-none font-pretendard ${
                passwordConfirm && passwordConfirm !== password
                  ? 'border-[#DB574F]'
                  : 'border-[#C3CCC9] focus:border-b-2 focus:border-[#2F9E44] caret-[#2F9E44]'
              }`}
            />
            {passwordConfirm && passwordConfirm !== password && (
              <p className="mt-1 text-xs text-[#DB574F] font-pretendard">
                ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏïÑÏöî.
              </p>
            )}
          </div>

          {/* Address */}
          <div>
            <label className="block text-[10px] text-[#C3CCC9] font-pretendard font-medium">
              Ï£ºÏÜå
            </label>
            <div className="mt-1 space-y-4">
              <div className="flex items-end gap-3">
                <input
                  name="postcode"
                  value={postcode}
                  onChange={e => setPostcode(e.target.value)}
                  placeholder="Ïö∞Ìé∏Î≤àÌò∏"
                  readOnly
                  aria-readonly
                  className="w-32 pb-1 border-b border-[#C3CCC9] bg-gray-50 text-gray-700 placeholder-[#C3CCC9] text-[17px] outline-none font-pretendard"
                />
                <button
                  type="button"
                  onClick={() => setShowPostcode(true)}
                  className="px-3 py-1.5 rounded-full border border-[#C3CCC9] text-[10px] text-gray-600 font-pretendard"
                >
                  Ïö∞Ìé∏Î≤àÌò∏ Ï∞æÍ∏∞
                </button>
              </div>
              <input
                name="address1"
                value={address1}
                onChange={e => setAddress1(e.target.value)}
                placeholder="Ï£ºÏÜåÎ•º Ï∞æÏïÑÏ£ºÏÑ∏Ïöî"
                readOnly
                aria-readonly
                className="w-full pb-1 border-b border-[#C3CCC9] bg-gray-50 text-gray-700 placeholder-[#C3CCC9] text-[17px] outline-none font-pretendard"
              />
              <input
                name="address2"
                value={address2}
                onChange={e => setAddress2(e.target.value)}
                placeholder="ÏÉÅÏÑ∏Ï£ºÏÜåÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî"
                ref={address2Ref}
                className="w-full pb-1 border-b border-[#C3CCC9] focus:border-b-2 focus:border-[#2F9E44] caret-[#2F9E44] placeholder-[#C3CCC9] text-[17px] text-gray-900 outline-none font-pretendard"
              />
            </div>
          </div>

          {/* Spacer */}
          <div className="h-1" />

          <div className="h-1" />
        </form>
      </main>

      {/* Bottom CTA */}
      <div className="fixed bottom-0 left-0 right-0 border-t border-gray-100 bg-white">
        <div className="max-w-sm mx-auto px-6 py-3">
          <button
            type="button"
            onClick={() => handleSubmit()}
            disabled={!canProceed || isLoading}
            className={`w-full py-3 rounded-[20px] font-pretendard text-[17px] shadow ${
              !canProceed || isLoading
                ? 'bg-[#98A7A4] text-white cursor-not-allowed'
                : 'bg-[#43AE52] text-white active:translate-y-[1px]'
            }`}
          >
            Îã§Ïùå
          </button>
          <div className="text-center mt-3">
            <span className="text-sm text-gray-600 font-pretendard">
              Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî?{' '}
            </span>
            <Link
              to="/login"
              className="text-indigo-600 hover:text-indigo-700 font-pretendard font-medium"
            >
              Î°úÍ∑∏Ïù∏
            </Link>
          </div>
        </div>
      </div>
      {/* Daum Postcode Modal */}
      <DaumPostcodeModal
        open={showPostcode}
        onClose={() => setShowPostcode(false)}
        onSelect={({ zonecode, address }) => {
          setPostcode(zonecode)
          setAddress1(address)
          setShowPostcode(false)
          setTimeout(() => address2Ref.current?.focus(), 0)
        }}
      />
    </div>
  )
}

export default Signup
